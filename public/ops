<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Fr8Coach • Ops Cards</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { color-scheme: dark; }
    @font-face {
      font-family: "Aptos Mono";
      src: url("/fonts/aptos-mono.woff2") format("woff2");
      font-weight: 100 900; font-style: normal; font-display: swap;
    }
    * { box-sizing: border-box; }
    body { margin:0; font-family:"Aptos Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background:#0b1220; color:#e6edf3; font-size:14px; }

    .topbar { position:sticky; top:0; z-index:10; background:rgba(11,18,32,.9); backdrop-filter:blur(6px); border-bottom:1px solid #223; padding:10px 16px; display:flex; gap:10px; align-items:center; }
    a { color:#9ab6ff; text-decoration:none; }
    a:hover { text-decoration:underline; }
    .wrap { max-width:1000px; margin:24px auto 80px; padding:0 16px; }
    .title-row { display:flex; align-items:center; gap:12px; margin-bottom:10px; }
    .cards { display:grid; grid-template-columns: repeat(auto-fit,minmax(260px,1fr)); gap:12px; margin:12px 0 28px; }
    .card { background:#111a2e; border:1px solid #223; border-radius:12px; padding:12px; }
    .muted { opacity:.8; font-size:12px; }
    .danger { background:#5b2230; border:1px solid #7a2d3d; color:#e6edf3; padding:8px 10px; border-radius:8px; cursor:pointer; }
    .danger:hover { background:#6a2a39; }
  </style>
</head>
<body>
  <div class="topbar">
    <a href="/">&larr; Back to Coach</a>
    <div style="flex:1"></div>
    <button id="lock" class="danger" title="Clear saved password">Lock</button>
  </div>

  <div class="wrap">
    <div class="title-row">
      <h1 style="margin:0">Ops Cards</h1>
      <span class="muted">Private</span>
    </div>
    <div id="cards" class="cards"></div>
  </div>

  <script>
    function savedPW(){ return localStorage.getItem('FR8COACH_PW') || ''; }
    async function api(path, opts = {}) {
      const headers = Object.assign({ 'Content-Type':'application/json', 'x-site-password': savedPW() }, opts.headers || {});
      const r = await fetch(path, Object.assign({}, opts, { headers }));
      if (!r.ok) {
        const txt = await r.text().catch(()=> '');
        throw new Error(`HTTP ${r.status}${txt ? ' – ' + txt : ''}`);
      }
      return r.json();
    }

    async function loadOps() {
      const el = document.getElementById('cards');
      el.innerHTML = '<div class="card">Loading…</div>';
      try {
        const data = await api('/api/cards?type=ops');
        const cards = data.cards || [];
        el.innerHTML = cards.length
          ? cards.map(c => `
              <div class="card">
                <div><strong>${escapeHtml(c.title || c.header || 'Card')}</strong></div>
                <div>${escapeHtml(c.body || c.content || '')}</div>
              </div>`).join('')
          : '<div class="card">No ops cards yet</div>';
      } catch (e) {
        el.innerHTML = `<div class="card">Failed to load (check password).<br/><span class="muted">${escapeHtml(e.message)}</span></div>`;
      }
    }

    function escapeHtml(s){return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}
    document.getElementById('lock').onclick = () => { localStorage.removeItem('FR8COACH_PW'); location.href = '/'; };
    loadOps();
  </script>
</body>
</html>
